import { requireRole } from '../../../utils/rbac.js'; import { r } from '../../../utils/redis.js'; export default defineEventHandler(async(e)=>{ requireRole(e,'EDITOR'); const id=e.context.params.id; const raw=await r().get('playlist:'+id); if(!raw) throw createError({status:404}); const b=await readBody(e); const pl=JSON.parse(raw); const i=Number(b.index); if(isNaN(i)||i<0||i>=pl.channels.length) throw createError({status:400}); pl.channels.splice(i,1); await r().set('playlist:'+id, JSON.stringify(pl)); return pl })
