import { requireRole } from '../../../utils/rbac.js'; import { r } from '../../../utils/redis.js'; export default defineEventHandler(async(e)=>{ requireRole(e,'EDITOR'); const id=e.context.params.id; const raw=await r().get('playlist:'+id); if(!raw) throw createError({status:404}); const b=await readBody(e); const pl=JSON.parse(raw); pl.channels.push({ name:b.name, url:b.url, logo:b.logo||'', category:b.category||'', ua:b.ua||'' }); await r().set('playlist:'+id, JSON.stringify(pl)); return pl })
