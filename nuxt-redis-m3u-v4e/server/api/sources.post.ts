import { requireRole } from '../utils/rbac.js'; import { r, nextId } from '../utils/redis.js'; export default defineEventHandler(async(e)=>{ requireRole(e,'EDITOR'); const b=await readBody(e); const id=await nextId('source'); const s={ id, url:String(b?.url||''), everyMin:Number(b?.everyMin||60), lastRun:0, status:'new', nextAt: Date.now()+5000 }; await r().set('source:'+id, JSON.stringify(s)); await r().sadd('org:1:sources', String(id)); return s })
